<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Meme Card Print Generator</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            font-family: 'Arial Black', Arial, sans-serif; 
            background: #f5f5f5; 
            padding: 20px;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { 
            text-align: center; 
            margin-bottom: 10px; 
            color: #333;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
            font-family: Arial, sans-serif;
            font-weight: normal;
        }
        .upload-area { 
            border: 3px dashed #667eea; 
            border-radius: 10px; 
            padding: 40px; 
            text-align: center; 
            cursor: pointer; 
            background: #f8f9ff;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .upload-area:hover { 
            border-color: #764ba2; 
            background: #f0f2ff;
        }
        .upload-area.active { 
            border-color: #00b894; 
            background: #e8fff8;
        }
        input[type="file"] { display: none; }
        .cards-input { 
            max-height: 500px; 
            overflow-y: auto; 
            margin-bottom: 20px;
        }
        .card-input-row { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 15px; 
            padding: 10px; 
            background: #f9f9f9; 
            border-radius: 8px;
        }
        .card-thumb { 
            width: 80px; 
            height: 80px; 
            object-fit: cover; 
            border-radius: 6px; 
            border: 2px solid #ddd;
        }
        .card-input-row input { 
            flex: 1; 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 6px; 
            font-size: 16px;
            font-weight: bold;
        }
        .btn { 
            width: 100%; 
            padding: 15px; 
            font-size: 18px; 
            font-weight: bold; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white;
        }
        .btn-primary:hover:not(:disabled) { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        .btn-primary:disabled { 
            opacity: 0.5; 
            cursor: not-allowed;
        }
        .btn-secondary { 
            background: white; 
            color: #667eea; 
            border: 2px solid #667eea;
        }
        .btn-secondary:hover { 
            background: #f0f2ff;
        }
        .preview-section { 
            display: none; 
            margin-top: 30px;
        }
        .preview-section.active { 
            display: block;
        }
        .preview-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            margin-bottom: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .preview-card { 
            width: 100%; 
            aspect-ratio: 0.716; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }
        .card-border { 
            width: 100%; 
            height: 100%; 
            padding: 12px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
        }
        .rarity-label { 
            background: white; 
            padding: 6px 20px; 
            border-radius: 20px; 
            font-size: 11px; 
            font-weight: 900; 
            margin-bottom: 8px;
            color: #2c3e50;
            border: 3px solid #2c3e50;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .card-image-container { 
            width: 90%; 
            aspect-ratio: 1.2;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 55%, #90EE90 55%, #6aa84f 100%);
            border-radius: 12px; 
            overflow: hidden; 
            margin-bottom: 8px; 
            border: 4px solid rgba(255,255,255,0.9);
            position: relative;
        }
        .card-image-container::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 35%;
            height: 20%;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            filter: blur(15px);
        }
        .card-image { 
            width: 100%; 
            height: 100%; 
            object-fit: cover;
        }
        .rarity-info { 
            background: white; 
            padding: 5px 15px; 
            border-radius: 15px; 
            font-size: 9px; 
            font-weight: 900; 
            margin-bottom: 8px;
            color: #2c3e50;
            border: 2px solid #2c3e50;
            letter-spacing: 0.3px;
        }
        .dots { 
            display: flex; 
            gap: 4px; 
            margin: 8px 0;
        }
        .dot { 
            width: 5px; 
            height: 5px; 
            border-radius: 50%; 
            background: white; 
            opacity: 0.9;
        }
        .meme-name { 
    background: white; 
    padding: 8px 15px; 
    border-radius: 15px; 
    font-size: 11px; /* Reduced from 13px */
    font-weight: 900; 
    margin-bottom: 8px; 
    text-align: center;
    color: #2c3e50;
    max-width: 85%;
    word-break: break-word;
    border: 3px solid rgba(44, 62, 80, 0.3);
    text-transform: uppercase;
    letter-spacing: 0.3px; /* Reduced from 0.5px */
    line-height: 1.3; /* Add line height for multi-line text */
    min-height: 30px; /* Ensure consistent height */
}
        .card-footer { 
            background: white; 
            padding: 4px 12px; 
            border-radius: 12px; 
            font-size: 7px; 
            font-weight: 900;
            color: #2c3e50;
            border: 2px solid rgba(44, 62, 80, 0.3);
            letter-spacing: 0.3px;
        }
        .common-bg { background: linear-gradient(135deg, #95a5a6 0%, #bdc3c7 100%); border: 4px solid #7f8c8d; }
        .uncommon-bg { background: linear-gradient(135deg, #00b894 0%, #55efc4 100%); border: 4px solid #009874; }
        .rare-bg { background: linear-gradient(135deg, #a29bfe 0%, #dda2e8 100%); border: 4px solid #8e7ce8; }
        .epic-bg { background: linear-gradient(135deg, #34495e 0%, #596b7d 100%); border: 4px solid #2c3e50; }
        .impossible-bg { background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); border: 4px solid #ee5a6f; }
        .legendary-bg { background: linear-gradient(135deg, #f1c40f 0%, #f9e79f 100%); border: 4px solid #d4a10a; }
        .expensive-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00b894 100%); border: 4px solid #5568d3; }
        .divine-bg { background: linear-gradient(135deg, #00008B 0%, #4B0082 100%); border: 4px solid #000070; }
        
        .page-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e8f4ff;
            border-radius: 8px;
            font-weight: bold;
            color: #333;
            font-family: Arial, sans-serif;
        }
        
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; padding: 0; max-width: none; }
            .upload-area, .cards-input, .btn, .page-info, h1, .subtitle { display: none !important; }
            .preview-section { display: block !important; margin: 0; }
            .preview-grid { 
                page-break-after: always; 
                padding: 0;
                background: white;
                gap: 0;
                width: 21cm;
                height: 29.7cm;
            }
            .preview-card {
                width: 6.3cm !important;
                height: 8.8cm !important;
            }
        }
        
        canvas { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ´ Meme Card Print Generator</h1>
        <div class="subtitle">Upload images, add titles, generate pages with 9 cards (6.3Ã—8.8cm)</div>
        
        <div class="upload-area" id="uploadArea">
            <div style="font-size: 48px; margin-bottom: 10px;">ðŸ“¸</div>
            <p id="uploadText">Click to upload meme images (up to 100)</p>
            <p style="font-size: 12px; color: #666; margin-top: 10px; font-family: Arial, sans-serif; font-weight: normal;">Multiple images will be split into pages of 9 cards each</p>
        </div>
        <input type="file" id="fileInput" accept="image/*" multiple>
        
        <div class="cards-input" id="cardsInput"></div>
        
        <button class="btn btn-primary" id="generateBtn" disabled>Generate Card Pages</button>
        
        <div class="preview-section" id="previewSection">
            <div class="page-info" id="pageInfo"></div>
            <div id="pagesContainer"></div>
            <button class="btn btn-primary" id="downloadBtn">Download All Pages as Images</button>
            <button class="btn btn-secondary" id="printBtn">Print Cards (Browser Print)</button>
            <button class="btn btn-secondary" id="resetBtn">Upload New Images</button>
        </div>
    </div>
    
    <canvas id="canvas"></canvas>
    
    <script>
        const rarities = [
            { name: 'Common', points: 100, class: 'common-bg', weight: 40 },
            { name: 'Uncommon', points: 50, class: 'uncommon-bg', weight: 25 },
            { name: 'Rare', points: 25, class: 'rare-bg', weight: 15 },
            { name: 'Epic', points: 20, class: 'epic-bg', weight: 10 },
            { name: 'Impossible', points: 5, class: 'impossible-bg', weight: 5 },
            { name: 'Legendary', points: 10, class: 'legendary-bg', weight: 3 },
            { name: 'Expensive', points: 1, class: 'expensive-bg', weight: 1.5 },
            { name: 'Divine', points: 15, class: 'divine-bg', weight: 0.5 }
        ];
        
        let images = [];
        let cardData = [];
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadText = document.getElementById('uploadText');
        const cardsInput = document.getElementById('cardsInput');
        const generateBtn = document.getElementById('generateBtn');
        const previewSection = document.getElementById('previewSection');
        const pagesContainer = document.getElementById('pagesContainer');
        const pageInfo = document.getElementById('pageInfo');
        
        uploadArea.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            const files = Array.from(e.target.files).slice(0, 100);
            if (files.length === 0) return;
            
            images = [];
            cardsInput.innerHTML = '';
            let loaded = 0;
            
            files.forEach((file, idx) => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    images[idx] = { url: ev.target.result, name: file.name };
                    loaded++;
                    
                    if (loaded === files.length) {
                        displayInputs();
                        uploadArea.classList.add('active');
                        uploadText.innerHTML = `<strong>${files.length} images uploaded!</strong><br>Click to change`;
                        checkReady();
                    }
                };
                reader.readAsDataURL(file);
            });
        };
        
        function displayInputs() {
            images.forEach((img, idx) => {
                const row = document.createElement('div');
                row.className = 'card-input-row';
                
                const thumb = document.createElement('img');
                thumb.src = img.url;
                thumb.className = 'card-thumb';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `Card title #${idx + 1}`;
                input.maxLength = 25;
                input.dataset.idx = idx;
                const baseName = img.name.replace(/\.[^/.]+$/, '').substring(0, 25);
                input.value = baseName;
                input.oninput = checkReady;
                
                row.appendChild(thumb);
                row.appendChild(input);
                cardsInput.appendChild(row);
            });
        }
        
        function checkReady() {
            const inputs = cardsInput.querySelectorAll('input');
            const allFilled = Array.from(inputs).every(inp => inp.value.trim());
            generateBtn.disabled = !allFilled || images.length === 0;
        }
        
        function getRandomRarity() {
            const total = rarities.reduce((sum, r) => sum + r.weight, 0);
            let rand = Math.random() * total;
            for (const r of rarities) {
                rand -= r.weight;
                if (rand <= 0) return r;
            }
            return rarities[0];
        }
        
        generateBtn.onclick = () => {
            cardData = [];
            const inputs = cardsInput.querySelectorAll('input');
            
            inputs.forEach((inp) => {
                const idx = parseInt(inp.dataset.idx);
                cardData.push({
                    image: images[idx].url,
                    name: inp.value.trim(),
                    rarity: getRandomRarity()
                });
            });
            
            displayPages();
            previewSection.classList.add('active');
            uploadArea.style.display = 'none';
            cardsInput.style.display = 'none';
            generateBtn.style.display = 'none';
        };
        
        function displayPages() {
            pagesContainer.innerHTML = '';
            const numPages = Math.ceil(cardData.length / 9);
            pageInfo.textContent = `Generated ${numPages} page${numPages > 1 ? 's' : ''} (${cardData.length} cards total)`;
            
            for (let p = 0; p < numPages; p++) {
                const pageCards = cardData.slice(p * 9, (p + 1) * 9);
                const grid = document.createElement('div');
                grid.className = 'preview-grid';
                
                pageCards.forEach(card => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'preview-card';
                    cardDiv.innerHTML = `
                        <div class="card-border ${card.rarity.class}">
                            <div class="rarity-label">${card.rarity.name}</div>
                            <div class="card-image-container">
                                <img src="${card.image}" class="card-image">
                            </div>
                            <div class="rarity-info">1/${card.rarity.points} RARITY</div>
                            <div class="dots">${'<div class="dot"></div>'.repeat(12)}</div>
                            <div class="meme-name">${wrapText(escapeHtml(card.name), 15)}</div>

// Add this helper function before the escapeHtml function:
function wrapText(text, maxCharsPerLine) {
    if (text.length <= maxCharsPerLine) return text;
    
    const words = text.split(' ');
    let lines = [];
    let currentLine = '';
    
    for (const word of words) {
        if ((currentLine + ' ' + word).trim().length <= maxCharsPerLine) {
            currentLine = (currentLine + ' ' + word).trim();
        } else {
            if (currentLine) lines.push(currentLine);
            currentLine = word;
        }
    }
    if (currentLine) lines.push(currentLine);
    
    return lines.slice(0, 2).join('<br>'); // Max 2 lines
}
                            <div class="card-footer">Â© MEME TRADING CARDS</div>
                        </div>
                    `;
                    grid.appendChild(cardDiv);
                });
                
                pagesContainer.appendChild(grid);
            }
        }
        
        document.getElementById('downloadBtn').onclick = async () => {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const dpi = 300;
            const cmToInch = 0.393701;
            const cardW = Math.round(6.3 * cmToInch * dpi);
            const cardH = Math.round(8.8 * cmToInch * dpi);
            
            const numPages = Math.ceil(cardData.length / 9);
            
            for (let p = 0; p < numPages; p++) {
                const pageCards = cardData.slice(p * 9, (p + 1) * 9);
                canvas.width = cardW * 3;
                canvas.height = cardH * 3;
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const drawPromises = pageCards.map((card, idx) => {
                    const col = idx % 3;
                    const row = Math.floor(idx / 3);
                    return drawCard(ctx, card, col * cardW, row * cardH, cardW, cardH);
                });
                
                await Promise.all(drawPromises);
                
                const link = document.createElement('a');
                link.download = `meme-cards-page-${p + 1}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        };
        
        document.getElementById('printBtn').onclick = () => {
            window.print();
        };
        
        document.getElementById('resetBtn').onclick = () => {
            images = [];
            cardData = [];
            cardsInput.innerHTML = '';
            fileInput.value = '';
            uploadArea.classList.remove('active');
            uploadText.innerHTML = 'Click to upload meme images (up to 100)<br><span style="font-size: 12px; color: #666; margin-top: 10px; font-family: Arial, sans-serif; font-weight: normal;">Multiple images will be split into pages of 9 cards each</span>';
            previewSection.classList.remove('active');
            uploadArea.style.display = 'block';
            cardsInput.style.display = 'block';
            generateBtn.style.display = 'block';
            generateBtn.disabled = true;
        };
        
        function drawCard(ctx, card, x, y, w, h) {
            return new Promise((resolve) => {
                const colors = {
                    'common-bg': ['#95a5a6', '#bdc3c7'],
                    'uncommon-bg': ['#00b894', '#55efc4'],
                    'rare-bg': ['#a29bfe', '#dda2e8'],
                    'epic-bg': ['#34495e', '#596b7d'],
                    'impossible-bg': ['#ff6b6b', '#ff8787'],
                    'legendary-bg': ['#f1c40f', '#f9e79f'],
                    'expensive-bg': ['#667eea', '#764ba2'],
                    'divine-bg': ['#00008B', '#4B0082']
                };
                
                const [c1, c2] = colors[card.rarity.class] || ['#667eea', '#764ba2'];
                const grad = ctx.createLinearGradient(x, y, x + w, y + h);
                grad.addColorStop(0, c1);
                grad.addColorStop(1, c2);
                ctx.fillStyle = grad;
                roundRect(ctx, x, y, w, h, w * 0.025);
                ctx.fill();
                
                const pad = w * 0.05;
                const innerX = x + pad;
                const innerY = y + pad;
                const innerW = w - pad * 2;
                
                // Rarity label
                ctx.fillStyle = 'white';
                roundRect(ctx, innerX + innerW * 0.2, innerY, innerW * 0.6, h * 0.09, h * 0.045);
                ctx.fill();
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = w * 0.005;
                roundRect(ctx, innerX + innerW * 0.2, innerY, innerW * 0.6, h * 0.09, h * 0.045);
                ctx.stroke();
                ctx.fillStyle = '#2c3e50';
                ctx.font = `900 ${h * 0.042}px Arial Black`;
                ctx.textAlign = 'center';
                ctx.fillText(card.rarity.name.toUpperCase(), x + w / 2, innerY + h * 0.062);
                
                const imgY = innerY + h * 0.11;
                const imgH = h * 0.42;
                
                // Sky and grass background
                const skyGrad = ctx.createLinearGradient(innerX, imgY, innerX, imgY + imgH);
                skyGrad.addColorStop(0, '#87CEEB');
                skyGrad.addColorStop(0.55, '#87CEEB');
                skyGrad.addColorStop(0.55, '#90EE90');
                skyGrad.addColorStop(1, '#6aa84f');
                ctx.fillStyle = skyGrad;
                roundRect(ctx, innerX, imgY, innerW, imgH, w * 0.02);
                ctx.fill();
                
                // Cloud effect
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.beginPath();
                ctx.ellipse(innerX + innerW * 0.35, imgY + imgH * 0.2, innerW * 0.15, imgH * 0.08, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Border for image container
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.lineWidth = w * 0.007;
                roundRect(ctx, innerX, imgY, innerW, imgH, w * 0.02);
                ctx.stroke();
                
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    ctx.save();
                    roundRect(ctx, innerX, imgY, innerW, imgH, w * 0.02);
                    ctx.clip();
                    ctx.drawImage(img, innerX, imgY, innerW, imgH);
                    ctx.restore();
                    
                    // Rarity info
                    const rarityY = imgY + imgH + h * 0.024;
                    ctx.fillStyle = 'white';
                    roundRect(ctx, innerX + innerW * 0.18, rarityY, innerW * 0.64, h * 0.065, h * 0.03);
                    ctx.fill();
                    ctx.strokeStyle = '#2c3e50';
                    ctx.lineWidth = w * 0.004;
                    roundRect(ctx, innerX + innerW * 0.18, rarityY, innerW * 0.64, h * 0.065, h * 0.03);
                    ctx.stroke();
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = `900 ${h * 0.034}px Arial Black`;
                    ctx.fillText(`1/${card.rarity.points} RARITY`, x + w / 2, rarityY + h * 0.046);
                    
                    // Dots
                    const dotsY = rarityY + h * 0.09;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    for (let i = 0; i < 12; i++) {
                        ctx.beginPath();
                        ctx.arc(innerX + (innerW / 13 * (i + 0.5)), dotsY, w * 0.008, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // Meme name
                    const nameY = dotsY + h * 0.05;
                    ctx.fillStyle = 'white';
                    roundRect(ctx, innerX + innerW * 0.075, nameY, innerW * 0.85, h * 0.095, h * 0.045);
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(44, 62, 80, 0.3)';
                    ctx.lineWidth = w * 0.005;
                    roundRect(ctx, innerX + innerW * 0.075, nameY, innerW * 0.85, h * 0.095, h * 0.045);
                    ctx.stroke();
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = `900 ${h * 0.05}px Arial Black`;
                    ctx.fillText(card.name.toUpperCase(), x + w / 2, nameY + h * 0.065);
                    
                    // Footer
                    const footerY = nameY + h * 0.125;
                    ctx.fillStyle = 'white';
                    roundRect(ctx, innerX + innerW * 0.15, footerY, innerW * 0.7, h * 0.05, h * 0.025);
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(44, 62, 80, 0.3)';
                    ctx.lineWidth = w * 0.003;
                    roundRect(ctx, innerX + innerW * 0.15, footerY, innerW * 0.7, h * 0.05, h * 0.025);
                    ctx.stroke();
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = `900 ${h * 0.027}px Arial Black`;
                    ctx.fillText('Â© MEME TRADING CARDS', x + w / 2, footerY + h * 0.036);
                    
                    resolve();
                };
                img.onerror = resolve;
                img.src = card.image;
            });
        }
        
        function roundRect(ctx, x, y, w, h, r) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        }
        
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/[&<>"']/g, m => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            })[m]);
        }
    </script>
</body>
</html>
